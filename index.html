<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Click Game</title>
<style>
  body { font-family: Arial; background: #222; color: white; text-align:center; }
  #cf-check { position:absolute;top:0;left:0;width:100%;height:100%;background:#f7f7f7;color:#333;
              display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;text-align:center;}
  .spinner { border:4px solid #f3f3f3; border-top:4px solid #3498db; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:20px;}
  @keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
  .game { display:none; margin-top:50px; }
  button { margin:5px; padding:10px; font-size:16px; }
</style>
</head>
<body>

<div id="cf-check">
  <h2>Checking your browser before accessing clicktonothing.netlify.app...</h2>
  <p>Please wait, this process is automatic. Your browser will redirect shortly.</p>
  <div class="spinner"></div>
  <button onclick="window.open('https://t.me/exdevrev','_blank')">Get Protection</button>
</div>

<div class="game" id="game">
  <h1>Нажми кнопку 1 000 000 раз!</h1>
  <p>Нажато: <span id="count">0</span></p>
  <p>Клики за одно нажатие: <span id="perClick">1</span></p>
  <p>Автоклики в сек: <span id="autoClicks">0</span></p>
  <button id="clickBtn">Нажми меня!</button><br>
  <button id="buyBtn">Купить улучшение (+1 за клик)</button>
  <button id="buyBtn10">Купить улучшение x10</button><br>
  <button id="autoBtn">Купить автоклик (+1/сек)</button>
  <button id="autoBtn10">Купить автоклик x10</button><br>
  <button id="prestigeBtn">Prestige</button>
  <button id="resetBtn" style="background:red;color:white;">Reset</button>
</div>

<script>
const userId = "user_" + btoa(navigator.userAgent);
const countSpan = document.getElementById("count");
const clickPerSpan = document.getElementById("perClick");
const autoSpan = document.getElementById("autoClicks");
const clickBtn = document.getElementById("clickBtn");
const buyBtn = document.getElementById("buyBtn");
const buyBtn10 = document.getElementById("buyBtn10");
const autoBtn = document.getElementById("autoBtn");
const autoBtn10 = document.getElementById("autoBtn10");
const prestigeBtn = document.getElementById("prestigeBtn");
const resetBtn = document.getElementById("resetBtn");

let data = JSON.parse(localStorage.getItem("clickGame")) || {
  clicks:0, clicksPerClick:1, autoClicks:0, prestige:0, buyCost:100, autoCost:100
};

function updateUI(){
  countSpan.textContent = data.clicks.toLocaleString();
  clickPerSpan.textContent = data.clicksPerClick;
  autoSpan.textContent = data.autoClicks;
}

async function saveData(){
  localStorage.setItem("clickGame", JSON.stringify(data));
  try {
    await fetch("/.netlify/functions/saveProgress", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({userId,data})
    });
  } catch(e){ console.log("Ошибка сервера:", e); }
}

async function loadData(){
  try {
    const res = await fetch(`/.netlify/functions/loadProgress?userId=${userId}`);
    const result = await res.json();
    if(result.success && result.data){ data = result.data; localStorage.setItem("clickGame", JSON.stringify(data)); }
    updateUI();
  } catch(e){ console.log("Ошибка загрузки:", e); }
}

// Фейковая проверка Cloudflare 3 сек
setTimeout(()=>{ document.getElementById("cf-check").style.display="none"; document.getElementById("game").style.display="block"; },3000);

// Кнопки
clickBtn.onclick = ()=>{ data.clicks += data.clicksPerClick; saveData(); updateUI(); }
buyBtn.onclick = ()=>{ if(data.clicks>=data.buyCost){ data.clicks-=data.buyCost; data.clicksPerClick+=1+data.prestige; data.buyCost+=50; saveData(); updateUI();} }
buyBtn10.onclick = ()=>{ for(let i=0;i<10;i++){ if(data.clicks>=data.buyCost){ data.clicks-=data.buyCost; data.clicksPerClick+=1+data.prestige; data.buyCost+=50; } } saveData(); updateUI(); }
autoBtn.onclick = ()=>{ if(data.clicks>=data.autoCost){ data.clicks-=data.autoCost; data.autoClicks+=1+data.prestige; data.autoCost+=100; saveData(); updateUI();} }
autoBtn10.onclick = ()=>{ for(let i=0;i<10;i++){ if(data.clicks>=data.autoCost){ data.clicks-=data.autoCost; data.autoClicks+=1+data.prestige; data.autoCost+=100;} } saveData(); updateUI(); }
prestigeBtn.onclick = ()=>{ if(data.clicks>=1000000){ data.prestige++; data.clicks=0; data.clicksPerClick=1; data.autoClicks=0; data.buyCost=100; data.autoCost=100; saveData(); updateUI(); alert("Prestige активирован!"); } }
resetBtn.onclick = ()=>{ if(confirm("Сбросить прогресс?")){ data={clicks:0, clicksPerClick:1, autoClicks:0, prestige:0, buyCost:100, autoCost:100}; saveData(); updateUI(); } }

// Автоклик
setInterval(()=>{ data.clicks += data.autoClicks; saveData(); updateUI(); },1000);

// Загрузка прогресса при старте
loadData();
updateUI();
</script>

</body>
</html>
